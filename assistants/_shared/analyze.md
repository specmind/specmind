# /analyze - Analyze Codebase

This prompt template contains the core logic for the `/analyze` command that analyzes a codebase and creates system architecture documentation.

## Instructions

1. **Run the analysis tool:**
   ```bash
   npx specmind analyze
   ```

2. **Review the split analysis output** in `.specmind/system/`:
   - `metadata.json`: Overall summary with services, architecture type, file counts, and cross-service dependencies
   - `architecture-diagram.md`: Pre-generated component/architecture diagram showing services, layers, and databases with brand colors
   - `sequence-diagram.md`: Pre-generated request flow diagram showing typical flow through layers
   - `services/{service}/metadata.json`: Service metadata with cross-layer dependencies
   - `services/{service}/{layer}/`: Per-layer chunked analysis (data, API, service, external layers)

   Each layer directory contains:
   - `summary.json`: Layer overview with chunk manifest, cross-layer dependencies, and layer-specific metadata (databases, APIs, external services)
   - `chunk-N.json`: File analysis chunks (≤256KB each, minified) with files, functions, classes, imports, and same-layer dependencies

3. **Analyze the split structure** to understand:
   - **Services**: How many services exist (monorepo vs monolith)
   - **Layers**: Distribution of code across data/API/service/external layers
   - **Technologies**: Databases, frameworks, external services in use
   - **Dependencies**: Key relationships between layers and services

4. **Review the pre-generated diagrams:**

   The analysis tool has already generated two Mermaid diagrams for you:

   - **`architecture-diagram.md`**: Component/architecture diagram showing:
     - Services (if monorepo) or layers (if monolith)
     - Architectural layers (data, API, service, external)
     - Databases with cylinder notation and brand colors (PostgreSQL blue, MongoDB green, Redis red, etc.)
     - External services and dependencies

   - **`sequence-diagram.md`**: Request flow diagram showing:
     - Typical request flow through the layers
     - API request → service layer → data layer → response
     - Database interactions
     - External service calls

   **You will use these pre-generated diagrams in the system.sm file** rather than creating new ones. Read both files to understand the system architecture.

5. **Generate markdown documentation:**

   **Recommended sections** (customize as needed):
   - **Overview**: High-level description of the system architecture
   - **Services**: List services (if monorepo) and their purposes
   - **Architectural Layers**: Describe data/API/service/external layer responsibilities
   - **Technology Stack**: Databases, frameworks, external services detected
   - **Design Decisions**: Key architectural decisions and rationale
   - **Integration Points**: How different parts of the system connect
   - **Notes**: Additional context, warnings, or optimization opportunities

   Feel free to add, remove, or modify sections to fit your documentation needs.

6. **Create the .specmind directory structure:**
   ```bash
   mkdir -p .specmind/features
   ```

7. **Write the system.sm file** at `.specmind/system.sm`:
   - Include markdown documentation with your chosen sections
   - Embed the pre-generated Mermaid diagrams from `architecture-diagram.md` and `sequence-diagram.md`
   - Read both diagram files and copy their Mermaid code blocks into system.sm
   - Example structure (customize as needed):
     ```markdown
     # System Architecture

     ## Overview
     [Your generated overview]

     ## Component Architecture
     [Copy the Mermaid diagram from architecture-diagram.md here]

     ## Request Flow
     [Copy the Mermaid diagram from sequence-diagram.md here]

     [Additional sections as needed]
     ```

8. **Confirm completion** to the user

## Expected Output

The `.specmind/system.sm` file should be created as a markdown file with:
- Documentation sections (structure is flexible)
- **Two pre-generated Mermaid diagrams** (copied from the generated diagram files):
  1. Component/architecture diagram (from `architecture-diagram.md`)
  2. Sequence/flow diagram (from `sequence-diagram.md`)

## Notes

- The diagrams are automatically generated by the analysis tool with accurate database colors and cylinder notation
- You should read both diagram files and copy them into system.sm rather than creating new diagrams
- This ensures consistency between the code analysis and the documentation
